# =============================================================================
# HIGH-LEVEL SETTINGS
# =============================================================================
# experiment_name: Unique identifier for this run. All outputs (checkpoints, logs) 
# will be saved in a folder with this name.
experiment_name: "von_mises_benchmark"

# seed: Integer for random number generator reproducibility. 
# Ensures data sampling and weight initialization are consistent across runs.
seed: 42

# =============================================================================
# DATA PIPELINE
# =============================================================================
data:
  # type: Source of training data. 
  # 'synthetic' generates targets from Hill48 math below. 
  # 'csv' loads from an external file (requires further config).
  type: "synthetic"         

  # positive_shear: Constrains the S12 shear stress range.
  # true: samples S12 in [0, max] | false: samples S12 in [-max, max]
  positive_shear: true      

  # input_range: Normalization range for stress inputs. Usually [-1, 1].
  input_range: [-1.0, 1.0]

  # samples: Number of points generated for the training set.
  samples:
    # loci: Points representing the general shape of the yield surface (Mask=0).
    loci: 200               
    # uniaxial: Specific points at different angles used to calculate R-values (Mask=1).
    uniaxial: 10            

# =============================================================================
# PHYSICS & CONSTRAINTS (The Material Model)
# =============================================================================
# These parameters define the "Target" material when data.type is 'synthetic'.
physics:
  # synthetic Hill48 parameters (Hill 1948)
  # F, G, H: Control anisotropy in the principal planes.
  # N: Controls the shear behavior. 
  # For Von Mises: F=G=H=0.5, N=1.5
  F: 0.25
  G: 0.83
  H: 0.17
  N: 2.24
  # F: 0.5
  # G: 0.5
  # H: 0.5
  # N: 1.5

physics_constraints:
  anisotropy:
    # enabled: If true, the model tries to match R-values (slopes of the surface).
    enabled: true           
    # batch_r_fraction: The portion of each training batch dedicated to R-value points.
    batch_r_fraction: 0.2   
    # interval: Frequency (in epochs) to perform a full uniaxial path validation.
    interval: 10            
  
  orthotropy:
    # enabled: If true, enforces symmetry constraints (dF/dS12 = 0 at the equator).
    enabled: true
    # samples: Number of equator points probed per check.
    samples: 100            
    # interval: Frequency (in epochs) to apply the orthotropy penalty.
    interval: 50            
    
  dynamic_convexity:
    # enabled: If true, probes the surface for "concave" regions and penalizes them.
    enabled: false
    # samples: Number of random points across the full 3D surface probed per check.
    samples: 1000           
    # interval: Frequency (in epochs) to run the heavy Hessian eigenvalue check.
    interval: 100           

# =============================================================================
# MODEL ARCHITECTURE
# =============================================================================
model:
  # hidden_layers: List of integers defining neurons per layer. [8, 8, 8, 8] is deep but narrow.
  hidden_layers: [8, 8, 8, 8]
  # activation: Activation function. 'softplus' is highly recommended as it has 
  # continuous second derivatives required for the Hessian convexity check.
  activation: "softplus"    
  # ref_stress: Normalization factor for the output stress value.
  ref_stress: 1.0
  # use_icnn_constraints: (Advanced) Enforces Input Convexity via non-negative weights.
  use_icnn_constraints: false

# =============================================================================
# TRAINING ENGINE
# =============================================================================
training:
  # epochs: Total number of passes through the full dataset.
  epochs: 100000
  # batch_size: Number of samples per gradient update.
  batch_size: 16
  # learning_rate: Speed of the Adam optimizer.
  learning_rate: 0.01
  # k_folds: Number of cross-validation folds. Set to 1 for standard training.
  k_folds: 1
  
  # Logging & Persistence
  save_dir: "outputs"
  # checkpoint_interval: Save model weights every N epochs.
  checkpoint_interval: 100
  # print_interval: Frequency of console log updates.
  print_interval: 25
  # overwrite: If true, deletes existing folders with the same experiment_name.
  overwrite: true

  # Curriculum Learning (Linear Weight Ramping)
  # NOTE: Ramping is currently disabled in the training engine. 
  # KEEP AT 0 to avoid discrepancies between printed logs and actual GPU execution.
  # DEV NOTE: To enable dynamic ramping, weights must be passed as stateful 
  # tf.Variable objects into the @tf.function graph to prevent constant capture.
  curriculum:
    r_warmup: 0           # 0 = disable (highly recommended)
    convexity_warmup: 0   # 0 = disable (highly recommended)

  # Dynamic Learning Rate
  lr_scheduler:
    # enabled: Reduces learning rate when the loss plateaus.
    enabled: true
    # patience: Number of epochs to wait before reducing LR.
    patience: 100           
    # factor: Multiplier to reduce LR (e.g., 0.9 = 10% reduction).
    factor: 0.9             
    # min_lr: The lowest possible learning rate allowed.
    min_lr: 1.0e-6

  # --- STOPPING THRESHOLDS ---
  # Training stops early only when ALL enabled conditions are met.
  stopping_criteria:
    loss_threshold: 0.01       # Total weighted objective
    r_threshold: 0.01          # Mean Absolute Error for R-values
    convexity_threshold: -1.0e-4 # Target for Minimum Eigenvalue (Tolerance)
    gnorm_threshold: 0.01      # Maximum global gradient norm (Stability)

  # --- LOSS WEIGHTS ---
  # Multipliers for each component of the total objective function.
  weights:
    # stress: Importance of matching the actual yield stress points.
    stress: 1.0
    # r_value: Importance of matching the anisotropy (R-values).
    r_value: 0.01
    
    # batch_convexity: Penalty for non-convexity on the training batch itself.
    batch_convexity: 0.01
    # dynamic_convexity: Penalty for non-convexity on random surface points.
    dynamic_convexity: 0.01
    # orthotropy: Penalty for symmetry violations.
    orthotropy: 0.01
    
    # gnorm_penalty: Regularization to prevent massive gradients (improves stability).
    gnorm_penalty: 1.0
